<?php
  	include "connect_db.php"; 
  	require_once("recommend.php");
  	$re = new Recommend();


$sql = "select * from question_list order by reg_date DESC"; 
$json = array();
$result = mysql_query($sql);
 
if(mysql_num_rows($result)){
while($row=mysql_fetch_assoc($result)){
$json['question_list'][]=$row;
}
}
$result = mysql_query("select * from knowledge_map");
 
if(mysql_num_rows($result)){
while($row=mysql_fetch_assoc($result)){
$json['map_list'][]=$row;
}
}

		$m_id = $_POST['m_id'];

		$user_score = array();

		$score_result = mysql_query("select * from my_map");

		if(mysql_num_rows($score_result)){										//사용자 관심도를 인출하여 각 유저당 키워드에 해당하는 관심도 할당
			while($row=mysql_fetch_assoc($score_result)){
				$user_id = $row[m_id];
				$user_keyword = $row[keyword];
				$user_rate = $row[rate];
				$user_score[$user_id][$user_keyword] = $user_rate;
			}
		}
		$score_result = $re->getRecommendations($user_score, $m_id);

		$correct_keyword = key($score_result);									//가장 관심도가 높은 키워드 추출
		$result = mysql_query("select * from question_list where keyword like '%$correct_keyword%';");         //답변수 숫자 출력
        
        if(mysql_num_rows($result)){
            while($row=mysql_fetch_assoc($result)){
                $json['best'][]=$row;
            }
        } else {
		else {
        	$json['best'][]=1;
        }
	}
mysql_close($connect);
echo json_encode($json); 
?>
